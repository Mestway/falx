!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.vega={})}("undefined"!=typeof self?self:this,function(n){"use strict";function y(n,t,e){return n.fields=t||[],n.fname=e,n}function m(n){return null==n?null:n.fields}function a(n){throw Error(n)}function b(n){var t,e,r,u=[],o=null,i=0,c=n.length,f="";function l(){u.push(f+n.substring(t,e)),f="",t=e+1}for(n+="",t=e=0;e<c;++e)if("\\"===(r=n[e]))f+=n.substring(t,e),t=++e;else if(r===o)l(),o=null,i=-1;else{if(o)continue;t===i&&'"'===r?(t=e+1,o=r):t===i&&"'"===r?(t=e+1,o=r):"."!==r||i?"["===r?(t<e&&l(),i=t=e+1):"]"===r&&(i||a("Access path missing open bracket: "+n),0<i&&l(),i=0,t=e+1):t<e?l():t=e+1}return i&&a("Access path missing closing bracket: "+n),o&&a("Access path missing closing quote: "+n),t<e&&(e++,l()),u}var t=Array.isArray;function e(n){return n===Object(n)}function r(n){return"string"==typeof n}function d(n){return t(n)?"["+n.map(d)+"]":e(n)||r(n)?JSON.stringify(n).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):n}function u(n,t){var e=b(n),r="return _["+e.map(d).join("][")+"];";return y(Function("_",r),[n=1===e.length?e[0]:n],t||n)}var o=[],i=u("id"),c=y(function(n){return n},o,"identity"),f=y(function(){return 0},o,"zero"),l=y(function(){return 1},o,"one"),s=y(function(){return!0},o,"true"),p=y(function(){return!1},o,"false");function h(n,t,e){var r=[t].concat([].slice.call(e));console[n].apply(console,r)}function g(n){return n[n.length-1]}function v(n){return null==n||""===n?null:+n}function j(t){return function(n){return t*Math.exp(n)}}function O(t){return function(n){return Math.log(t*n)}}function x(t){return function(n){return n<0?-Math.pow(-n,t):Math.pow(n,t)}}function z(n,t,e,r){var u=e(n[0]),o=e(g(n)),i=(o-u)*t;return[r(u-i),r(o-i)]}function M(n,t,e,r,u){var o=r(n[0]),i=r(g(n)),c=null!=t?r(t):(o+i)/2;return[u(c+(o-c)*e),u(c+(i-c)*e)]}function k(n){return null!=n?t(n)?n:[n]:[]}function w(n){return"function"==typeof n}var A={};function E(n){return"[object Date]"===Object.prototype.toString.call(n)}function D(n){return"number"==typeof n}function N(n,t){for(var e="";0<=--t;)e+=n;return e}function F(n){return D(n)?n:E(n)?n:Date.parse(n)}n.accessor=y,n.accessorName=function(n){return null==n?null:n.fname},n.accessorFields=m,n.id=i,n.identity=c,n.zero=f,n.one=l,n.truthy=s,n.falsy=p,n.logger=function(n){var t=n||0;return{level:function(n){return arguments.length?(t=+n,this):t},error:function(){return 1<=t&&h("error","ERROR",arguments),this},warn:function(){return 2<=t&&h("warn","WARN",arguments),this},info:function(){return 3<=t&&h("log","INFO",arguments),this},debug:function(){return 4<=t&&h("log","DEBUG",arguments),this}}},n.None=0,n.Error=1,n.Warn=2,n.Info=3,n.Debug=4,n.panLinear=function(n,t){return z(n,t,v,c)},n.panLog=function(n,t){var e=Math.sign(n[0]);return z(n,t,O(e),j(e))},n.panPow=function(n,t,e){return z(n,t,x(e),x(1/e))},n.zoomLinear=function(n,t,e){return M(n,t,e,v,c)},n.zoomLog=function(n,t,e){var r=Math.sign(n[0]);return M(n,t,e,O(r),j(r))},n.zoomPow=function(n,t,e,r){return M(n,t,e,x(r),x(1/r))},n.array=k,n.compare=function(n,t){var e,r,u,o,i,c,f,l,a,s=[],p=(n=k(n)).map(function(n,t){return null==n?null:(s.push(t),w(n)?n:b(n).map(d).join("]["))}),h=s.length-1,g=k(t),v="var u,v;return ";if(h<0)return null;for(r=0;r<=h;++r)w(u=p[e=s[r]])?(o="(u=this."+(c="f"+e)+"(a))",i="(v=this."+c+"(b))",(f=f||{})[c]=u):(o="(u=a["+u+"])",i="(v=b["+u+"])"),c="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",v+="("+o+"<"+i+"||u==null)&&v!=null?"+(l="descending"!==g[e]?-(a=1):(a=-1,1))+":(u>v||v==null)&&u!=null?"+a+":"+c+"!==u&&v===v?"+l+":v!==v&&u===u?"+a+(e<h?":":":0");return u=Function("a","b",v+";"),f&&(u=u.bind(f)),n=n.reduce(function(t,n){return w(n)?(m(n)||[]).forEach(function(n){t[n]=1}):null!=n&&(t[n+""]=1),t},{}),y(u,Object.keys(n))},n.constant=function(n){return w(n)?n:function(){return n}},n.debounce=function(t,n){var e,r;function u(){n(r),e=r=null}return function(n){r=n,e&&clearTimeout(e),e=setTimeout(u,t)}},n.error=a,n.extend=function(n){for(var t,e,r=1,u=arguments.length;r<u;++r)for(e in t=arguments[r])n[e]=t[e];return n},n.extentIndex=function(n,t){var e,r,u,o,i,c=-1,f=n.length;if(null==t){for(;++c<f;)if(null!=(r=n[c])&&r<=r){e=u=r;break}for(o=i=c;++c<f;)null!=(r=n[c])&&(r<e&&(e=r,o=c),u<r&&(u=r,i=c))}else{for(;++c<f;)if(null!=(r=t(n[c],c,n))&&r<=r){e=u=r;break}for(o=i=c;++c<f;)null!=(r=t(n[c],c,n))&&(r<e&&(e=r,o=c),u<r&&(u=r,i=c))}return[o,i]},n.fastmap=function(t){var u,o,i={};function e(n){return i.hasOwnProperty(n)&&i[n]!==A}return u={size:0,empty:0,object:i,has:e,get:function(n){return e(n)?i[n]:void 0},set:function(n,t){return e(n)||(++u.size,i[n]===A&&--u.empty),i[n]=t,this},delete:function(n){return e(n)&&(--u.size,++u.empty,i[n]=A),this},clear:function(){u.size=u.empty=0,u.object=i={}},test:function(n){return arguments.length?(o=n,u):o},clean:function(){var n,t,e={},r=0;for(n in i)(t=i[n])===A||o&&o(t)||(e[n]=t,++r);u.size=r,u.empty=0,u.object=i=e}},t&&Object.keys(t).forEach(function(n){u.set(n,t[n])}),u},n.field=u,n.inherits=function(n,t){var e=n.prototype=Object.create(t.prototype);return e.constructor=n,e},n.isArray=t,n.isBoolean=function(n){return"boolean"==typeof n},n.isDate=E,n.isFunction=w,n.isNumber=D,n.isObject=e,n.isRegExp=function(n){return"[object RegExp]"===Object.prototype.toString.call(n)},n.isString=r,n.key=function(n,t){return n&&(n=t?k(n).map(function(n){return n.replace(/\\(.)/g,"$1")}):k(n)),y(n&&n.length?Function("_","return ''+"+n.map(function(n){return"_["+(t?d(n):b(n).map(d).join("]["))+"]"}).join("+'|'+")+";"):function(){return""},n,"key")},n.merge=function(n,t,e,r){var u=t.length,o=e.length;if(!o)return t;if(!u)return e;for(var i=r||new t.constructor(u+o),c=0,f=0,l=0;c<u&&f<o;++l)i[l]=0<n(t[c],e[f])?e[f++]:t[c++];for(;c<u;++c,++l)i[l]=t[c];for(;f<o;++f,++l)i[l]=e[f];return i},n.pad=function(n,t,e,r){var u=e||" ",o=n+"",i=t-o.length;return i<=0?o:"left"===r?N(u,i)+o:"center"===r?N(u,~~(i/2))+o+N(u,Math.ceil(i/2)):o+N(u,i)},n.peek=g,n.repeat=N,n.splitAccessPath=b,n.stringValue=d,n.toBoolean=function(n){return null==n||""===n?null:!(!n||"false"===n||"0"===n||!n)},n.toDate=function(n,t){return t=t||F,null==n||""===n?null:t(n)},n.toNumber=v,n.toString=function(n){return null==n||""===n?null:n+""},n.toSet=function(n){for(var t={},e=0,r=n.length;e<r;++e)t[n[e]]=!0;return t},n.truncate=function(n,t,e,r){var u=null!=r?r:"â€¦",o=n+"",i=o.length,c=Math.max(0,t-u.length);return i<=t?o:"left"===e?u+o.slice(i-c):"center"===e?o.slice(0,Math.ceil(c/2))+u+o.slice(i-~~(c/2)):o.slice(0,c)+u},n.visitArray=function(n,t,e){if(n){var r,u=0,o=n.length;if(t)for(;u<o;++u)(r=t(n[u]))&&e(r,u,n);else n.forEach(e)}},Object.defineProperty(n,"__esModule",{value:!0})});