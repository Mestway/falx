!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],t):t(n.vega={},n.d3)}(this,function(h,l){"use strict";function s(n,t){var r,e=[],a=n.length,o=-1;if(null==t)for(;++o<a;)isNaN(r=u(n[o]))||e.push(r);else for(;++o<a;)isNaN(r=u(t(n[o],o,n)))||e.push(r);return e}function u(n){return null===n?NaN:+n}function f(n,t){var r=s(n,t);return[l.quantile(r.sort(l.ascending),.25),l.quantile(r,.5),l.quantile(r,.75)]}function n(n,t){var u,i,a=NaN,r={mean:function(n){return arguments.length?(u=n||0,a=NaN,r):u},stdev:function(n){return arguments.length?(i=null==n?1:n,a=NaN,r):i},sample:function(){var n,t,r=0,e=0;if(a==a)return r=a,a=NaN,r;for(;0===(n=(r=2*h.random()-1)*r+(e=2*h.random()-1)*e)||1<n;);return t=Math.sqrt(-2*Math.log(n)/n),a=u+e*t*i,u+r*t*i},pdf:function(n){var t=Math.exp(Math.pow(n-u,2)/(-2*Math.pow(i,2)));return 1/(i*Math.sqrt(2*Math.PI))*t},cdf:function(n){var t,r=(n-u)/i,e=Math.abs(r);if(37<e)t=0;else{var a=Math.exp(-e*e/2);e<7.07106781186547?(t=a*((((((.0352624965998911*e+.700383064443688)*e+6.37396220353165)*e+33.912866078383)*e+112.079291497871)*e+221.213596169931)*e+220.206867912376),t/=((((((.0883883476483184*e+1.75566716318264)*e+16.064177579207)*e+86.7807322029461)*e+296.564248779674)*e+637.333633378831)*e+793.826512519948)*e+440.413735824752):t=a/(e+1/(e+2/(e+3/(e+4/(e+.65)))))/2.506628274631}return 0<r?1-t:t},icdf:function(n){if(n<=0||1<=n)return NaN;var t=2*n-1,r=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),e=2/(Math.PI*r)+Math.log(1-Math.pow(t,2))/2,a=Math.log(1-t*t)/r,o=(0<t?1:-1)*Math.sqrt(Math.sqrt(e*e-a)-e);return u+i*Math.SQRT2*o}};return r.mean(n).stdev(t)}h.random=Math.random,h.bin=function(n){var t,r,e,a,o,u,i,f,c=n.maxbins||20,d=n.base||10,h=Math.log(d),l=n.divide||[5,2],s=n.extent[0],p=n.extent[1],M=p-s;if(n.step)t=n.step;else if(n.steps){for(o=M/c,u=0,i=n.steps.length;u<i&&n.steps[u]<o;++u);t=n.steps[Math.max(0,u-1)]}else{for(r=Math.ceil(Math.log(c)/h),e=n.minstep||0,t=Math.max(e,Math.pow(d,Math.round(Math.log(M)/h)-r));Math.ceil(M/t)>c;)t*=d;for(u=0,i=l.length;u<i;++u)e<=(o=t/l[u])&&M/o<=c&&(t=o)}return a=0<=(o=Math.log(t))?0:1+~~(-o/h),f=Math.pow(d,-a-1),(n.nice||void 0===n.nice)&&(s=s<(o=Math.floor(s/t+f)*t)?o-t:o,p=Math.ceil(p/t)*t),{start:s,stop:p,step:t}},h.bootstrapCI=function(n,t,r,e){if(!n.length)return[void 0,void 0];var a,o,u,i,f=s(n,e),c=f.length,d=t;for(u=0,i=Array(d);u<d;++u){for(o=a=0;o<c;++o)a+=f[~~(h.random()*c)];i[u]=a/c}return[l.quantile(i.sort(l.ascending),r/2),l.quantile(i,1-r/2)]},h.quartiles=f,h.setRandom=function(n){h.random=n},h.randomInteger=function(n,t){null==t&&(t=n,n=0);var r,e,a,o={};return o.min=function(n){return arguments.length?(a=e-(r=n||0),o):r},o.max=function(n){return arguments.length?(a=(e=n||0)-r,o):e},o.sample=function(){return r+Math.floor(a*h.random())},o.pdf=function(n){return n===Math.floor(n)&&r<=n&&n<e?1/a:0},o.cdf=function(n){var t=Math.floor(n);return t<r?0:e<=t?1:(t-r+1)/a},o.icdf=function(n){return 0<=n&&n<=1?r-1+Math.floor(n*a):NaN},o.min(n).max(t)},h.randomKDE=function(o,u){var e=n(),i={},a=0;return i.data=function(n){return arguments.length?(a=(o=n)?n.length:0,i.bandwidth(u)):o},i.bandwidth=function(n){return arguments.length?(!(u=n)&&o&&(r=(t=o).length,e=f(t),a=(e[2]-e[0])/1.34,u=1.06*Math.min(Math.sqrt(l.variance(t)),a)*Math.pow(r,-.2)),i):u;var t,r,e,a},i.sample=function(){return o[~~(h.random()*a)]+u*e.sample()},i.pdf=function(n){for(var t=0,r=0;r<a;++r)t+=e.pdf((n-o[r])/u);return t/u/a},i.cdf=function(n){for(var t=0,r=0;r<a;++r)t+=e.cdf((n-o[r])/u);return t/a},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(o)},h.randomMixture=function(a,t){var o,r={},u=0;return r.weights=function(n){return arguments.length?(o=function(n){var t,r=[],e=0;for(t=0;t<u;++t)e+=r[t]=null==n[t]?1:+n[t];for(t=0;t<u;++t)r[t]/=e;return r}(t=n||[]),r):t},r.distributions=function(n){return arguments.length?(a=n?(u=n.length,n):(u=0,[]),r.weights(t)):a},r.sample=function(){for(var n=h.random(),t=a[u-1],r=o[0],e=0;e<u-1;r+=o[++e])if(n<r){t=a[e];break}return t.sample()},r.pdf=function(n){for(var t=0,r=0;r<u;++r)t+=o[r]*a[r].pdf(n);return t},r.cdf=function(n){for(var t=0,r=0;r<u;++r)t+=o[r]*a[r].cdf(n);return t},r.icdf=function(){throw Error("Mixture icdf not supported.")},r.distributions(a).weights(t)},h.randomNormal=n,h.randomUniform=function(n,t){null==t&&(t=null==n?1:n,n=0);var r,e,a,o={};return o.min=function(n){return arguments.length?(a=e-(r=n||0),o):r},o.max=function(n){return arguments.length?(a=(e=n||0)-r,o):e},o.sample=function(){return r+a*h.random()},o.pdf=function(n){return r<=n&&n<=e?1/a:0},o.cdf=function(n){return n<r?0:e<n?1:(n-r)/a},o.icdf=function(n){return 0<=n&&n<=1?r+n*a:NaN},o.min(n).max(t)},Object.defineProperty(h,"__esModule",{value:!0})});