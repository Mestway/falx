{"version":3,"file":"parse.js","sourceRoot":"","sources":["../../../../src/compile/axis/parse.ts"],"names":[],"mappings":"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","sourcesContent":["import {Axis as VgAxis, AxisEncode as VgAxisEncode, AxisOrient, SignalRef} from 'vega';\nimport {Axis, AXIS_PARTS, isAxisProperty, VG_AXIS_PROPERTIES} from '../../axis';\nimport {isBinned} from '../../bin';\nimport {POSITION_SCALE_CHANNELS, PositionScaleChannel, X, Y} from '../../channel';\nimport {FieldDefBase, toFieldDefBase} from '../../fielddef';\nimport {getFirstDefined, keys} from '../../util';\nimport {mergeTitle, mergeTitleComponent, mergeTitleFieldDefs, numberFormat} from '../common';\nimport {guideEncodeEntry} from '../guide';\nimport {LayerModel} from '../layer';\nimport {parseGuideResolve} from '../resolve';\nimport {defaultTieBreaker, Explicit, mergeValuesWithExplicit} from '../split';\nimport {UnitModel} from '../unit';\nimport {AxisComponent, AxisComponentIndex, AxisComponentProps} from './component';\nimport {getAxisConfig} from './config';\nimport * as encode from './encode';\nimport * as properties from './properties';\n\nexport function parseUnitAxis(model: UnitModel): AxisComponentIndex {\n  return POSITION_SCALE_CHANNELS.reduce(\n    (axis, channel) => {\n      if (model.component.scales[channel] && model.axis(channel)) {\n        axis[channel] = [parseAxis(channel, model)];\n      }\n      return axis;\n    },\n    {} as AxisComponentIndex\n  );\n}\n\nconst OPPOSITE_ORIENT: {[K in AxisOrient]: AxisOrient} = {\n  bottom: 'top',\n  top: 'bottom',\n  left: 'right',\n  right: 'left'\n};\n\nexport function parseLayerAxis(model: LayerModel) {\n  const {axes, resolve} = model.component;\n  const axisCount: {\n    // Using Mapped Type to declare type (https://www.typescriptlang.org/docs/handbook/advanced-types.html#mapped-types)\n    [k in AxisOrient]: number\n  } = {top: 0, bottom: 0, right: 0, left: 0};\n\n  for (const child of model.children) {\n    child.parseAxisAndHeader();\n\n    for (const channel of keys(child.component.axes)) {\n      resolve.axis[channel] = parseGuideResolve(model.component.resolve, channel);\n      if (resolve.axis[channel] === 'shared') {\n        // If the resolve says shared (and has not been overridden)\n        // We will try to merge and see if there is a conflict\n\n        axes[channel] = mergeAxisComponents(axes[channel], child.component.axes[channel]);\n\n        if (!axes[channel]) {\n          // If merge returns nothing, there is a conflict so we cannot make the axis shared.\n          // Thus, mark axis as independent and remove the axis component.\n          resolve.axis[channel] = 'independent';\n          delete axes[channel];\n        }\n      }\n    }\n  }\n\n  // Move axes to layer's axis component and merge shared axes\n  for (const channel of [X, Y]) {\n    for (const child of model.children) {\n      if (!child.component.axes[channel]) {\n        // skip if the child does not have a particular axis\n        continue;\n      }\n\n      if (resolve.axis[channel] === 'independent') {\n        // If axes are independent, concat the axisComponent array.\n        axes[channel] = (axes[channel] || []).concat(child.component.axes[channel]);\n\n        // Automatically adjust orient\n        for (const axisComponent of child.component.axes[channel]) {\n          const {value: orient, explicit} = axisComponent.getWithExplicit('orient');\n          if (axisCount[orient] > 0 && !explicit) {\n            // Change axis orient if the number do not match\n            const oppositeOrient = OPPOSITE_ORIENT[orient];\n            if (axisCount[orient] > axisCount[oppositeOrient]) {\n              axisComponent.set('orient', oppositeOrient, false);\n            }\n          }\n          axisCount[orient]++;\n\n          // TODO(https://github.com/vega/vega-lite/issues/2634): automatically add extra offset?\n        }\n      }\n\n      // After merging, make sure to remove axes from child\n      delete child.component.axes[channel];\n    }\n  }\n}\n\nfunction mergeAxisComponents(mergedAxisCmpts: AxisComponent[], childAxisCmpts: AxisComponent[]): AxisComponent[] {\n  if (mergedAxisCmpts) {\n    // FIXME: this is a bit wrong once we support multiple axes\n    if (mergedAxisCmpts.length !== childAxisCmpts.length) {\n      return undefined; // Cannot merge axis component with different number of axes.\n    }\n    const length = mergedAxisCmpts.length;\n    for (let i = 0; i < length; i++) {\n      const merged = mergedAxisCmpts[i];\n      const child = childAxisCmpts[i];\n\n      if (!!merged !== !!child) {\n        return undefined;\n      } else if (merged && child) {\n        const mergedOrient = merged.getWithExplicit('orient');\n        const childOrient = child.getWithExplicit('orient');\n\n        if (mergedOrient.explicit && childOrient.explicit && mergedOrient.value !== childOrient.value) {\n          // TODO: throw warning if resolve is explicit (We don't have info about explicit/implicit resolve yet.)\n\n          // Cannot merge due to inconsistent orient\n          return undefined;\n        } else {\n          mergedAxisCmpts[i] = mergeAxisComponent(merged, child);\n        }\n      }\n    }\n  } else {\n    // For first one, return a copy of the child\n    return childAxisCmpts.map(axisComponent => axisComponent.clone());\n  }\n  return mergedAxisCmpts;\n}\n\nfunction mergeAxisComponent(merged: AxisComponent, child: AxisComponent): AxisComponent {\n  for (const prop of VG_AXIS_PROPERTIES) {\n    const mergedValueWithExplicit = mergeValuesWithExplicit<VgAxis, any>(\n      merged.getWithExplicit(prop),\n      child.getWithExplicit(prop),\n      prop,\n      'axis',\n\n      // Tie breaker function\n      (v1: Explicit<any>, v2: Explicit<any>) => {\n        switch (prop) {\n          case 'title':\n            return mergeTitleComponent(v1, v2);\n          case 'gridScale':\n            return {\n              explicit: v1.explicit, // keep the old explicit\n              value: getFirstDefined(v1.value, v2.value)\n            };\n        }\n        return defaultTieBreaker<VgAxis, any>(v1, v2, prop, 'axis');\n      }\n    );\n    merged.setWithExplicit(prop, mergedValueWithExplicit);\n  }\n  return merged;\n}\n\nfunction getFieldDefTitle(model: UnitModel, channel: 'x' | 'y') {\n  const channel2 = channel === 'x' ? 'x2' : 'y2';\n  const fieldDef = model.fieldDef(channel);\n  const fieldDef2 = model.fieldDef(channel2);\n\n  const title1 = fieldDef ? fieldDef.title : undefined;\n  const title2 = fieldDef2 ? fieldDef2.title : undefined;\n\n  if (title1 && title2) {\n    return mergeTitle(title1, title2);\n  } else if (title1) {\n    return title1;\n  } else if (title2) {\n    return title2;\n  } else if (title1 !== undefined) {\n    // falsy value to disable config\n    return title1;\n  } else if (title2 !== undefined) {\n    // falsy value to disable config\n    return title2;\n  }\n\n  return undefined;\n}\n\nfunction isExplicit<T extends string | number | object | boolean>(\n  value: T,\n  property: keyof VgAxis,\n  axis: Axis,\n  model: UnitModel,\n  channel: PositionScaleChannel\n) {\n  switch (property) {\n    case 'values':\n      return !!axis.values;\n    // specified axis.values is already respected, but may get transformed.\n    case 'encode':\n      // both VL axis.encoding and axis.labelAngle affect VG axis.encode\n      return !!axis.encoding || !!axis.labelAngle;\n    case 'title':\n      // title can be explicit if fieldDef.title is set\n      if (value === getFieldDefTitle(model, channel)) {\n        return true;\n      }\n  }\n  // Otherwise, things are explicit if the returned value matches the specified property\n  return value === axis[property];\n}\n\nfunction parseAxis(channel: PositionScaleChannel, model: UnitModel): AxisComponent {\n  const axis = model.axis(channel);\n\n  const axisComponent = new AxisComponent();\n\n  // 1.2. Add properties\n  VG_AXIS_PROPERTIES.forEach(property => {\n    const value = getProperty(property, axis, channel, model);\n    if (value !== undefined) {\n      const explicit = isExplicit(value, property, axis, model, channel);\n\n      const configValue = getAxisConfig(\n        property,\n        model.config,\n        channel,\n        axisComponent.get('orient'),\n        model.getScaleComponent(channel).get('type')\n      );\n\n      // only set property if it is explicitly set or has no config value (otherwise we will accidentally override config)\n      if (explicit || configValue === undefined) {\n        // Do not apply implicit rule if there is a config value\n        axisComponent.set(property, value, explicit);\n      } else if (property === 'grid' && configValue) {\n        // Grid is an exception because we need to set grid = true to generate another grid axis\n        axisComponent.set(property, configValue, false);\n      }\n    }\n  });\n\n  // 2) Add guide encode definition groups\n  const axisEncoding = axis.encoding || {};\n  const axisEncode = AXIS_PARTS.reduce(\n    (e: VgAxisEncode, part) => {\n      if (!axisComponent.hasAxisPart(part)) {\n        // No need to create encode for a disabled part.\n        return e;\n      }\n\n      const axisEncodingPart = guideEncodeEntry(axisEncoding[part] || {}, model);\n\n      const value =\n        part === 'labels'\n          ? encode.labels(model, channel, axisEncodingPart, axisComponent.get('orient'))\n          : axisEncodingPart;\n\n      if (value !== undefined && keys(value).length > 0) {\n        e[part] = {update: value};\n      }\n      return e;\n    },\n    {} as VgAxisEncode\n  );\n\n  // FIXME: By having encode as one property, we won't have fine grained encode merging.\n  if (keys(axisEncode).length > 0) {\n    axisComponent.set('encode', axisEncode, !!axis.encoding || axis.labelAngle !== undefined);\n  }\n\n  return axisComponent;\n}\n\nfunction getProperty<K extends keyof AxisComponentProps>(\n  property: K,\n  specifiedAxis: Axis,\n  channel: PositionScaleChannel,\n  model: UnitModel\n): AxisComponentProps[K] {\n  const fieldDef = model.fieldDef(channel);\n\n  // Some properties depend on labelAngle so we have to declare it here.\n  // Also, we don't use `getFirstDefined` for labelAngle\n  // as we want to normalize specified value to be within [0,360)\n  const labelAngle = properties.labelAngle(model, specifiedAxis, channel, fieldDef);\n\n  switch (property) {\n    case 'scale':\n      return model.scaleName(channel);\n    case 'gridScale':\n      return properties.gridScale(model, channel);\n    case 'format':\n      // We don't include temporal field here as we apply format in encode block\n      return numberFormat(fieldDef, specifiedAxis.format, model.config);\n    case 'grid': {\n      if (isBinned(model.fieldDef(channel).bin)) {\n        return false;\n      } else {\n        const scaleType = model.getScaleComponent(channel).get('type');\n        return getFirstDefined(specifiedAxis.grid, properties.defaultGrid(scaleType, fieldDef));\n      }\n    }\n    case 'labelAlign':\n      return getFirstDefined(\n        specifiedAxis.labelAlign,\n        properties.defaultLabelAlign(labelAngle, properties.orient(channel))\n      );\n    case 'labelAngle':\n      return labelAngle;\n    case 'labelBaseline':\n      return getFirstDefined(\n        specifiedAxis.labelBaseline,\n        properties.defaultLabelBaseline(labelAngle, properties.orient(channel))\n      );\n    case 'labelFlush':\n      return getFirstDefined(specifiedAxis.labelFlush, properties.defaultLabelFlush(fieldDef, channel));\n    case 'labelOverlap': {\n      const scaleType = model.getScaleComponent(channel).get('type');\n      return getFirstDefined(specifiedAxis.labelOverlap, properties.defaultLabelOverlap(fieldDef, scaleType));\n    }\n    case 'orient':\n      return getFirstDefined(specifiedAxis.orient, properties.orient(channel));\n    case 'tickCount': {\n      const scaleType = model.getScaleComponent(channel).get('type');\n      const scaleName = model.scaleName(channel);\n      const sizeType = channel === 'x' ? 'width' : channel === 'y' ? 'height' : undefined;\n      const size = sizeType ? model.getSizeSignalRef(sizeType) : undefined;\n      return getFirstDefined<number | SignalRef>(\n        specifiedAxis.tickCount,\n        properties.defaultTickCount({fieldDef, scaleType, size, scaleName, specifiedAxis})\n      );\n    }\n    case 'title':\n      const channel2 = channel === 'x' ? 'x2' : 'y2';\n      const fieldDef2 = model.fieldDef(channel2);\n      // Keep undefined so we use default if title is unspecified.\n      // For other falsy value, keep them so we will hide the title.\n      return getFirstDefined<string | FieldDefBase<string>[]>(\n        specifiedAxis.title,\n        getFieldDefTitle(model, channel), // If title not specified, store base parts of fieldDef (and fieldDef2 if exists)\n        mergeTitleFieldDefs([toFieldDefBase(fieldDef)], fieldDef2 ? [toFieldDefBase(fieldDef2)] : [])\n      );\n\n    case 'values':\n      return properties.values(specifiedAxis, model, fieldDef, channel);\n  }\n  // Otherwise, return specified property.\n  return isAxisProperty(property) ? specifiedAxis[property] : undefined;\n}\n"]}