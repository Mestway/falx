{"version":3,"file":"repeat.js","sourceRoot":"","sources":["../../../src/compile/repeat.ts"],"names":[],"mappings":"AACA,OAAO,KAAK,GAAG,MAAM,QAAQ,CAAC;AAI9B,OAAO,EAAC,eAAe,EAAC,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAC,UAAU,EAAC,MAAM,cAAc,CAAC;AACxC,OAAO,EAAC,qBAAqB,EAAC,MAAM,oBAAoB,CAAC;AAIzD,MAAM,OAAO,WAAY,SAAQ,eAAe;IAM9C,YACE,IAA0B,EAC1B,MAAa,EACb,eAAuB,EACvB,YAA2B,EAC3B,MAAc;QAEd,KAAK,CAAC,IAAI,EAAE,MAAM,EAAE,eAAe,EAAE,MAAM,EAAE,YAAY,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QAZ3D,SAAI,GAAa,QAAQ,CAAC;QAcxC,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,KAAK,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,KAAK,QAAQ,CAAC,EAAE;YAC/G,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,wBAAwB,CAAC,CAAC;SAChD;QAED,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;IAC9E,CAAC;IAEO,aAAa,CAAC,IAA0B,EAAE,MAAc,EAAE,QAAuB,EAAE,MAAc;QACvG,MAAM,QAAQ,GAAY,EAAE,CAAC;QAC7B,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;QAC3D,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;QAEpE,gBAAgB;QAChB,KAAK,MAAM,QAAQ,IAAI,GAAG,EAAE;YAC1B,KAAK,MAAM,WAAW,IAAI,MAAM,EAAE;gBAChC,MAAM,IAAI,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,GAAG,WAAW,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;gBAEvF,MAAM,WAAW,GAAG;oBAClB,GAAG,EAAE,QAAQ;oBACb,MAAM,EAAE,WAAW;iBACpB,CAAC;gBAEF,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,EAAE,SAAS,EAAE,WAAW,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;aACjH;SACF;QAED,OAAO,QAAQ,CAAC;IAClB,CAAC;IAEM,eAAe;QACpB,qBAAqB,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;IAES,qBAAqB;QAC7B,OAAO;YACL,OAAO,EAAE,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAC1E,MAAM,EAAE,MAAM;YACd,KAAK,EAAE,KAAK;SACb,CAAC;IACJ,CAAC;CACF","sourcesContent":["import {Config} from '../config';\nimport * as log from '../log';\nimport {NormalizedRepeatSpec} from '../spec';\nimport {Repeat} from '../spec/repeat';\nimport {VgLayout} from '../vega.schema';\nimport {BaseConcatModel} from './baseconcat';\nimport {buildModel} from './buildmodel';\nimport {parseRepeatLayoutSize} from './layoutsize/parse';\nimport {Model} from './model';\nimport {RepeaterValue} from './repeater';\n\nexport class RepeatModel extends BaseConcatModel {\n  public readonly type: 'repeat' = 'repeat';\n  public readonly repeat: Repeat;\n\n  public readonly children: Model[];\n\n  constructor(\n    spec: NormalizedRepeatSpec,\n    parent: Model,\n    parentGivenName: string,\n    repeatValues: RepeaterValue,\n    config: Config\n  ) {\n    super(spec, parent, parentGivenName, config, repeatValues, spec.resolve);\n\n    if (spec.resolve && spec.resolve.axis && (spec.resolve.axis.x === 'shared' || spec.resolve.axis.y === 'shared')) {\n      log.warn(log.message.REPEAT_CANNOT_SHARE_AXIS);\n    }\n\n    this.repeat = spec.repeat;\n    this.children = this._initChildren(spec, this.repeat, repeatValues, config);\n  }\n\n  private _initChildren(spec: NormalizedRepeatSpec, repeat: Repeat, repeater: RepeaterValue, config: Config): Model[] {\n    const children: Model[] = [];\n    const row = repeat.row || [repeater ? repeater.row : null];\n    const column = repeat.column || [repeater ? repeater.column : null];\n\n    // cross product\n    for (const rowField of row) {\n      for (const columnField of column) {\n        const name = (rowField ? '_' + rowField : '') + (columnField ? '_' + columnField : '');\n\n        const childRepeat = {\n          row: rowField,\n          column: columnField\n        };\n\n        children.push(buildModel(spec.spec, this, this.getName('child' + name), undefined, childRepeat, config, false));\n      }\n    }\n\n    return children;\n  }\n\n  public parseLayoutSize() {\n    parseRepeatLayoutSize(this);\n  }\n\n  protected assembleDefaultLayout(): VgLayout {\n    return {\n      columns: this.repeat && this.repeat.column ? this.repeat.column.length : 1,\n      bounds: 'full',\n      align: 'all'\n    };\n  }\n}\n"]}