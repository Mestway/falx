{"version":3,"file":"windowfacet.js","sourceRoot":"","sources":["../../../../src/compile/data/windowfacet.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,OAAO,EAAC,MAAM,gBAAgB,CAAC;AACvC,OAAO,EAAC,WAAW,EAAC,MAAM,YAAY,CAAC;AAEvC,OAAO,EAAC,kBAAkB,EAAC,MAAM,UAAU,CAAC;AAE5C,OAAO,EAAC,mBAAmB,EAAC,MAAM,UAAU,CAAC;AAE7C,MAAM,UAAU,mBAAmB,CAAC,MAAoB,EAAE,KAA2B;IACnF,MAAM,EAAC,GAAG,EAAE,MAAM,EAAC,GAAG,KAAK,CAAC;IAC5B,IAAI,GAAG,IAAI,MAAM,EAAE;QACjB,IAAI,SAAS,GAAG,IAAI,CAAC;QACrB,0CAA0C;QAC1C,KAAK,MAAM,QAAQ,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,EAAE;YACpC,IAAI,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;gBAC9B,MAAM,EAAC,KAAK,EAAE,EAAE,EAAC,GAAG,QAAQ,CAAC,IAAI,CAAC;gBAClC,MAAM,GAAG,SAAS,GAAG,IAAI,mBAAmB,CAAC,MAAM,EAAE;oBACnD,MAAM,EAAE;wBACN;4BACE,EAAE;4BACF,KAAK;4BACL,EAAE,EAAE,kBAAkB,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,EAAC,CAAC;yBAC/D;qBACF;oBACD,OAAO,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;oBAC5B,KAAK,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC;iBACpB,CAAC,CAAC;aACJ;SACF;QACD,OAAO,SAAS,CAAC;KAClB;IACD,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import {vgField} from '../../fielddef';\nimport {isSortField} from '../../sort';\nimport {FacetMapping} from '../../spec/facet';\nimport {facetSortFieldName} from '../facet';\nimport {DataFlowNode} from './dataflow';\nimport {WindowTransformNode} from './window';\n\nexport function makeWindowFromFacet(parent: DataFlowNode, facet: FacetMapping<string>): WindowTransformNode {\n  const {row, column} = facet;\n  if (row && column) {\n    let newParent = null;\n    // only need to make one for crossed facet\n    for (const fieldDef of [row, column]) {\n      if (isSortField(fieldDef.sort)) {\n        const {field, op} = fieldDef.sort;\n        parent = newParent = new WindowTransformNode(parent, {\n          window: [\n            {\n              op,\n              field,\n              as: facetSortFieldName(fieldDef, fieldDef.sort, {forAs: true})\n            }\n          ],\n          groupby: [vgField(fieldDef)],\n          frame: [null, null]\n        });\n      }\n    }\n    return newParent;\n  }\n  return null;\n}\n"]}