!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util")):"function"==typeof define&&define.amd?define(["exports","vega-util"],t):t(e.vega={},e.vega)}(this,function(e,h){"use strict";function l(e){this.type=e}var t,s,f,i,p;l.prototype.visit=function(e){var t,r,n;if(e(this))return 1;for(r=0,n=(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":var t=e.arguments.slice();return t.unshift(e.callee),t;case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;r<n;++r)if(t[r].visit(e))return 1};var a=1,d=2,v=3,o=4,u=5,c=6,g=7,y=8;(t={})[a]="Boolean",t[d]="<end>",t[v]="Identifier",t[o]="Keyword",t[u]="Null",t[c]="Numeric",t[g]="Punctuator",t[y]="String",t[9]="RegularExpression";var n="ArrayExpression",m="BinaryExpression",x="CallExpression",C="ConditionalExpression",w="Identifier",r="Literal",b="LogicalExpression",E="MemberExpression",M="ObjectExpression",A="Property",k="UnaryExpression",O="Unexpected token %0",S="Unexpected number",U="Unexpected string",L="Unexpected identifier",I="Unexpected reserved word",N="Unexpected end of input",T="Invalid regular expression",j="Invalid regular expression: missing /",F="Octal literals are not allowed in strict mode.",D="Duplicate data property in object literal not allowed in strict mode",P="ILLEGAL",R="Disabled.",_=new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),q=new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]");function B(e,t){if(!e)throw new Error("ASSERT: "+t)}function G(e){return 48<=e&&e<=57}function Q(e){return 0<="0123456789abcdefABCDEF".indexOf(e)}function V(e){return 0<="01234567".indexOf(e)}function z(e){return 10===e||13===e||8232===e||8233===e}function X(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||92===e||128<=e&&_.test(String.fromCharCode(e))}function H(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||92===e||128<=e&&q.test(String.fromCharCode(e))}var Y={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function K(){for(var e,t;f<i&&(e=s.charCodeAt(f),32===(t=e)||9===t||11===t||12===t||160===t||5760<=t&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)||z(e));)++f}function $(e){var t,r,n,a=0;for(r="u"===e?4:2,t=0;t<r;++t)f<i&&Q(s[f])?(n=s[f++],a=16*a+"0123456789abcdef".indexOf(n.toLowerCase())):fe({},O,P);return String.fromCharCode(a)}function J(){var e,t,r,n;for(t=0,"}"===(e=s[f])&&fe({},O,P);f<i&&Q(e=s[f++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(1114111<t||"}"!==e)&&fe({},O,P),t<=65535?String.fromCharCode(t):(r=55296+(t-65536>>10),n=56320+(t-65536&1023),String.fromCharCode(r,n))}function W(){var e,t;for(e=s.charCodeAt(f++),t=String.fromCharCode(e),92===e&&(117!==s.charCodeAt(f)&&fe({},O,P),++f,(e=$("u"))&&"\\"!==e&&X(e.charCodeAt(0))||fe({},O,P),t=e);f<i&&H(e=s.charCodeAt(f));)++f,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==s.charCodeAt(f)&&fe({},O,P),++f,(e=$("u"))&&"\\"!==e&&H(e.charCodeAt(0))||fe({},O,P),t+=e);return t}function Z(){var e,t;return e=f,{type:1===(t=92===s.charCodeAt(f)?W():function(){var e,t;for(e=f++;f<i;){if(92===(t=s.charCodeAt(f)))return f=e,W();if(!H(t))break;++f}return s.slice(e,f)}()).length?v:Y.hasOwnProperty(t)?o:"null"===t?u:"true"===t||"false"===t?a:v,value:t,start:e,end:f}}function ee(){var e,t,r,n,a=f,o=s.charCodeAt(f),i=s[f];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++f,{type:g,value:String.fromCharCode(o),start:a,end:f};default:if(61===(e=s.charCodeAt(f+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return f+=2,{type:g,value:String.fromCharCode(o)+String.fromCharCode(e),start:a,end:f};case 33:case 61:return f+=2,61===s.charCodeAt(f)&&++f,{type:g,value:s.slice(a,f),start:a,end:f}}}return">>>="===(n=s.substr(f,4))?{type:g,value:n,start:a,end:f+=4}:">>>"===(r=n.substr(0,3))||"<<="===r||">>="===r?{type:g,value:r,start:a,end:f+=3}:i===(t=r.substr(0,2))[1]&&0<="+-<>&|".indexOf(i)||"=>"===t?{type:g,value:t,start:a,end:f+=2}:0<="<>=!+-*%&|^/".indexOf(i)?{type:g,value:i,start:a,end:++f}:void fe({},O,P)}function te(){var e,t,r;if(B(G((r=s[f]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),t=f,e="","."!==r){if(e=s[f++],r=s[f],"0"===e){if("x"===r||"X"===r)return++f,function(e){for(var t="";f<i&&Q(s[f]);)t+=s[f++];return 0===t.length&&fe({},O,P),X(s.charCodeAt(f))&&fe({},O,P),{type:c,value:parseInt("0x"+t,16),start:e,end:f}}(t);if(V(r))return function(e){for(var t="0"+s[f++];f<i&&V(s[f]);)t+=s[f++];return(X(s.charCodeAt(f))||G(s.charCodeAt(f)))&&fe({},O,P),{type:c,value:parseInt(t,8),octal:!0,start:e,end:f}}(t);r&&G(r.charCodeAt(0))&&fe({},O,P)}for(;G(s.charCodeAt(f));)e+=s[f++];r=s[f]}if("."===r){for(e+=s[f++];G(s.charCodeAt(f));)e+=s[f++];r=s[f]}if("e"===r||"E"===r)if(e+=s[f++],"+"!==(r=s[f])&&"-"!==r||(e+=s[f++]),G(s.charCodeAt(f)))for(;G(s.charCodeAt(f));)e+=s[f++];else fe({},O,P);return X(s.charCodeAt(f))&&fe({},O,P),{type:c,value:parseFloat(e),start:t,end:f}}function re(){var e,t,r,n;return p=null,K(),e=f,t=function(){var e,t,r,n;for(B("/"===(e=s[f]),"Regular expression literal must start with a slash"),t=s[f++],n=r=!1;f<i;)if(t+=e=s[f++],"\\"===e)z((e=s[f++]).charCodeAt(0))&&fe({},j),t+=e;else if(z(e.charCodeAt(0)))fe({},j);else if(r)"]"===e&&(r=!1);else{if("/"===e){n=!0;break}"["===e&&(r=!0)}return n||fe({},j),{value:t.substr(1,t.length-2),literal:t}}(),r=function(){var e,t,r;for(r=t="";f<i&&H((e=s[f]).charCodeAt(0));)++f,"\\"===e&&f<i?fe({},O,P):(r+=e,t+=e);return 0<=r.search(/[^gimuy]/g)&&fe({},T,r),{value:r,literal:t}}(),n=function(e,t){var r=e;0<=t.indexOf("u")&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t){if(parseInt(t,16)<=1114111)return"x";fe({},T)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{return new RegExp(e,t)}catch(e){return null}}(t.value,r.value),{literal:t.literal+r.literal,value:n,regex:{pattern:t.value,flags:r.value},start:e,end:f}}function ne(){var e;return K(),i<=f?{type:d,start:f,end:f}:X(e=s.charCodeAt(f))?Z():40===e||41===e||59===e?ee():39===e||34===e?function(){var e,t,r,n,a="",o=!1;for(B("'"===(e=s[f])||'"'===e,"String literal must starts with a quote"),t=f,++f;f<i;){if((r=s[f++])===e){e="";break}if("\\"===r)if((r=s[f++])&&z(r.charCodeAt(0)))"\r"===r&&"\n"===s[f]&&++f;else switch(r){case"u":case"x":"{"===s[f]?(++f,a+=J()):a+=$(r);break;case"n":a+="\n";break;case"r":a+="\r";break;case"t":a+="\t";break;case"b":a+="\b";break;case"f":a+="\f";break;case"v":a+="\v";break;default:V(r)?(0!==(n="01234567".indexOf(r))&&(o=!0),f<i&&V(s[f])&&(o=!0,n=8*n+"01234567".indexOf(s[f++]),0<="0123".indexOf(r)&&f<i&&V(s[f])&&(n=8*n+"01234567".indexOf(s[f++]))),a+=String.fromCharCode(n)):a+=r}else{if(z(r.charCodeAt(0)))break;a+=r}}return""!==e&&fe({},O,P),{type:y,value:a,octal:o,start:t,end:f}}():46===e?G(s.charCodeAt(f+1))?te():ee():G(e)?te():ee()}function ae(){var e;return f=(e=p).end,p=ne(),f=e.end,e}function oe(){var e;e=f,p=ne(),f=e}function ie(e,t,r){var n=new l("||"===e||"&&"===e?b:m);return n.operator=e,n.left=t,n.right=r,n}function se(e){var t=new l(w);return t.name=e,t}function ue(e){var t=new l(r);return t.value=e.value,t.raw=s.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function ce(e,t,r){var n=new l(E);return n.computed="["===e,n.object=t,n.property=r,n.computed||(r.member=!0),n}function le(e,t,r){var n=new l(A);return n.key=t,n.value=r,n.kind=e,n}function fe(e,t){var r,n=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,function(e,t){return B(t<n.length,"Message reference must be in range"),n[t]});throw(r=new Error(a)).index=f,r.description=a,r}function pe(e){e.type===d&&fe(e,N),e.type===c&&fe(e,S),e.type===y&&fe(e,U),e.type===v&&fe(e,L),e.type===o&&fe(e,I),fe(e,O,e.value)}function de(e){var t=ae();t.type===g&&t.value===e||pe(t)}function he(e){return p.type===g&&p.value===e}function ve(e){return p.type===o&&p.value===e}function ge(){var e,t,r=[];for(f=p.start,de("[");!he("]");)he(",")?(ae(),r.push(null)):(r.push(ke()),he("]")||de(","));return ae(),e=r,(t=new l(n)).elements=e,t}function ye(){var e;return f=p.start,(e=ae()).type===y||e.type===c?(e.octal&&fe(e,F),ue(e)):se(e.value)}function me(){var e,t,r,n,a,o,i,s=[],u={},c=String;for(f=p.start,de("{");!he("}");)a=n=r=void 0,f=p.start,t="$"+((e=(r=p).type===v?(a=ye(),de(":"),le("init",a,ke())):r.type!==d&&r.type!==g?(n=ye(),de(":"),le("init",n,ke())):void pe(r)).key.type===w?e.key.name:c(e.key.value)),Object.prototype.hasOwnProperty.call(u,t)?fe({},D):u[t]=!0,s.push(e),he("}")||de(",");return de("}"),o=s,(i=new l(M)).properties=o,i}var xe={if:1,this:1};function Ce(){var e,t,r,n;if(he("("))return de("("),n=Oe(),de(")"),n;if(he("["))return ge();if(he("{"))return me();if(e=p.type,f=p.start,e===v||xe[p.value])r=se(ae().value);else if(e===y||e===c)p.octal&&fe(p,F),r=ue(ae());else{if(e===o)throw new Error(R);e===a?((t=ae()).value="true"===t.value,r=ue(t)):e===u?((t=ae()).value=null,r=ue(t)):he("/")||he("/=")?(r=ue(re()),oe()):pe(ae())}return r}function we(){var e=[];if(de("("),!he(")"))for(;f<i&&(e.push(ke()),!he(")"));)de(",");return de(")"),e}function be(){var e,t;return f=p.start,e=ae(),(t=e).type!==v&&t.type!==o&&t.type!==a&&t.type!==u&&pe(e),se(e.value)}function Ee(){var e=function(){var e,t,r,n,a,o;for(e=Ce();;)if(he("."))de("."),e=ce(".",e,be());else if(he("("))t=we(),n=e,a=t,o=void 0,(o=new l(x)).callee=n,o.arguments=a,e=o;else{if(!he("["))break;r=void 0,de("["),r=Oe(),de("]"),e=ce("[",e,r)}return e}();if(p.type===g&&(he("++")||he("--")))throw new Error(R);return e}function Me(){var e,t,r,n,a;if(p.type!==g&&p.type!==o)t=Ee();else{if(he("++")||he("--"))throw new Error(R);if(he("+")||he("-")||he("~")||he("!"))e=ae(),t=Me(),r=e.value,n=t,(a=new l(k)).operator=r,a.argument=n,a.prefix=!0,t=a;else{if(ve("delete")||ve("void")||ve("typeof"))throw new Error(R);t=Ee()}}return t}function Ae(e){var t=0;if(e.type!==g&&e.type!==o)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function ke(){var e,t,r,n,a,o,i;return e=function(){var e,t,r,n,a,o,i,s,u,c;if(e=p,u=Me(),0===(a=Ae(n=p)))return u;for(n.prec=a,ae(),t=[e,p],o=[u,n,i=Me()];0<(a=Ae(p));){for(;2<o.length&&a<=o[o.length-2].prec;)i=o.pop(),s=o.pop().value,u=o.pop(),t.pop(),r=ie(s,u,i),o.push(r);(n=ae()).prec=a,o.push(n),t.push(p),r=Me(),o.push(r)}for(r=o[c=o.length-1],t.pop();1<c;)t.pop(),r=ie(o[c-1].value,o[c-2],r),c-=2;return r}(),he("?")&&(ae(),t=ke(),de(":"),r=ke(),n=e,a=t,o=r,(i=new l(C)).test=n,i.consequent=a,i.alternate=o,e=i),e}function Oe(){var e=ke();if(he(","))throw new Error(R);return e}var Se={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Ue(c){function e(i,s,u){return function(e){return t=i,n=s,a=u,o=c((r=e)[0]),n&&(o=n+"("+o+")",0===n.lastIndexOf("new ",0)&&(o="("+o+")")),o+"."+t+(a<0?"":0===a?"()":"("+r.slice(1).map(c).join(",")+")");var t,r,n,a,o}}var t="new Date",r="String";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&h.error("Missing arguments to clamp function."),3<e.length&&h.error("Too many arguments to clamp function.");var t=e.map(c);return"Math.max("+t[1]+", Math.min("+t[2]+","+t[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:t,date:e("getDate",t,0),day:e("getDay",t,0),year:e("getFullYear",t,0),month:e("getMonth",t,0),hours:e("getHours",t,0),minutes:e("getMinutes",t,0),seconds:e("getSeconds",t,0),milliseconds:e("getMilliseconds",t,0),time:e("getTime",t,0),timezoneoffset:e("getTimezoneOffset",t,0),utcdate:e("getUTCDate",t,0),utcday:e("getUTCDay",t,0),utcyear:e("getUTCFullYear",t,0),utcmonth:e("getUTCMonth",t,0),utchours:e("getUTCHours",t,0),utcminutes:e("getUTCMinutes",t,0),utcseconds:e("getUTCSeconds",t,0),utcmilliseconds:e("getUTCMilliseconds",t,0),length:e("length",null,-1),indexof:e("indexOf",null),lastindexof:e("lastIndexOf",null),slice:e("slice",null),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",r,0),lower:e("toLowerCase",r,0),substring:e("substring",r),split:e("split",r),replace:e("replace",r),regexp:"RegExp",test:e("test","RegExp"),if:function(e){e.length<3&&h.error("Missing arguments to if function."),3<e.length&&h.error("Too many arguments to if function.");var t=e.map(c);return"("+t[0]+"?"+t[1]+":"+t[2]+")"}}}e.ASTNode=l,e.parse=function(e){f=0,i=(s=e).length,p=null,oe();var t=Oe();if(p.type!==d)throw new Error("Unexpect token after expression.");return t},e.codegen=function(e){var r=(e=e||{}).whitelist?h.toSet(e.whitelist):{},n=e.blacklist?h.toSet(e.blacklist):{},a=e.constants||Se,o=(e.functions||Ue)(f),t=e.globalvar,i=e.fieldvar,s={},u={},c=0,l=h.isFunction(t)?t:function(e){return t+'["'+e+'"]'};function f(e){if(h.isString(e))return e;var t=p[e.type];return null==t&&h.error("Unsupported type: "+e.type),t(e)}var p={Literal:function(e){return e.raw},Identifier:function(e){var t=e.name;return 0<c?t:n.hasOwnProperty(t)?h.error("Illegal identifier: "+t):a.hasOwnProperty(t)?a[t]:r.hasOwnProperty(t)?t:(s[t]=1,l(t))},MemberExpression:function(e){var t=!e.computed,r=f(e.object);t&&(c+=1);var n=f(e.property);return r===i&&(u[n]=1),t&&(c-=1),r+(t?"."+n:"["+n+"]")},CallExpression:function(e){"Identifier"!==e.callee.type&&h.error("Illegal callee type: "+e.callee.type);var t=e.callee.name,r=e.arguments,n=o.hasOwnProperty(t)&&o[t];return n||h.error("Unrecognized function: "+t),h.isFunction(n)?n(r):n+"("+r.map(f).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(f).join(",")+"]"},BinaryExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+f(e.argument)+")"},ConditionalExpression:function(e){return"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")"},LogicalExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(f).join(",")+"}"},Property:function(e){c+=1;var t=f(e.key);return c-=1,t+":"+f(e.value)}};function d(e){var t={code:f(e),globals:Object.keys(s),fields:Object.keys(u)};return s={},u={},t}return d.functions=o,d.constants=a,d},e.functions=Ue,e.constants=Se,Object.defineProperty(e,"__esModule",{value:!0})});